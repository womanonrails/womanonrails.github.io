<!DOCTYPE html><html lang="pl"><head><meta charset='utf-8'><title>Refaktoring w Ruby krok po kroku - część 2</title><meta name='description' content='Jak zrobić refaktoring? <br> Od kodu zorientowanego obiektowo do kompozycji.'><meta name='viewport' content='width=device-width, initial-scale=1.0'><meta name="generator" content="Jekyll v4.0.1" /><meta property="og:title" content="Refaktoring w Ruby krok po kroku - część 2" /><meta name="author" content="womanonrails" /><meta property="og:locale" content="pl" /><meta name="description" content="Jak zrobić refaktoring? Od kodu zorientowanego obiektowo do kompozycji." /><meta property="og:description" content="Jak zrobić refaktoring? Od kodu zorientowanego obiektowo do kompozycji." /><link rel="canonical" href="https://womanonrails.com/pl/refactoring-part2" /><meta property="og:url" content="https://womanonrails.com/pl/refactoring-part2" /><meta property="og:site_name" content="Woman on Rails" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2018-11-25T00:00:00-05:00" /> <script type="application/ld+json"> {"description":"Jak zrobić refaktoring? Od kodu zorientowanego obiektowo do kompozycji.","url":"https://womanonrails.com/pl/refactoring-part2","@type":"BlogPosting","headline":"Refaktoring w Ruby krok po kroku - część 2","dateModified":"2018-11-25T00:00:00-05:00","datePublished":"2018-11-25T00:00:00-05:00","mainEntityOfPage":{"@type":"WebPage","@id":"https://womanonrails.com/pl/refactoring-part2"},"author":{"@type":"Person","name":"womanonrails"},"publisher":{"@type":"Organization","logo":{"@type":"ImageObject","url":"https://womanonrails.com/pl/womanonrails-square.svg"},"name":"womanonrails"},"@context":"https://schema.org"}</script><meta name='twitter:card' content='summary'><meta name='twitter:creator' content='@womanonrails'><meta name='twitter:description' content='Jak zrobić refaktoring? <br> Od kodu zorientowanego obiektowo do kompozycji.'><meta name='twitter:image' content='https://womanonrails.com/images/womanonrails-square.svg'><meta name='twitter:title' content='Refaktoring w Ruby krok po kroku - część 2'><meta property='og:description' content='Jak zrobić refaktoring? <br> Od kodu zorientowanego obiektowo do kompozycji.'><meta property='og:image' content='https://womanonrails.com/images/womanonrails-1000x1000.jpg'><meta property='og:title' content='Refaktoring w Ruby krok po kroku - część 2'><meta property='og:type' content='website'><link href='https://womanonrails.com/favicon.ico' rel='shortcut icon' type='image/x-icon' /><link href='https://womanonrails.com/favicon.png' rel='shortcut icon' type='image/png' /><link href='/pl/feed.xml' rel='alternate' title='Woman on Rails Feed' type='application/atom+xml' /><link async href='/assets/css/bootstrap.css' media='all' rel='stylesheet' /><link href='/assets/css/style.css' media='all' rel='stylesheet' /><link href='/css/main.css' media='all' rel='stylesheet' /><link href='/assets/css/applause-button.css' rel='stylesheet' /> <script defer src='/assets/js/applause-button.js'></script><div class="search-wrapper"><div class="search-form"> <input type="text" class="search-field" placeholder="Search..."> <span class='js-remove-sign'> <span class='svg--cancel'><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 375 375"><path d="M187.5 2.5a185 185 0 0 0-185 185 185 185 0 0 0 185 185 185 185 0 0 0 185-185 185 185 0 0 0-185-185zm-85.906 78.875a20.232 20.232 0 0 1 14.518 6.132l71.388 71.388 71.388-71.388a20.232 20.232 0 0 1 13.909-6.121 20.232 20.232 0 0 1 14.702 34.73l-71.39 71.388 71.39 71.39a20.232 20.232 0 1 1-28.61 28.61L187.5 216.115l-71.388 71.389a20.232 20.232 0 1 1-28.611-28.61l71.39-71.39-71.39-71.388a20.232 20.232 0 0 1 14.093-34.74z"/></svg></span> </span><ul class="search-results post-list"></ul></div></div></head><body class="post-template" itemscope itemtype="https://schema.org/WebPage"><div id="fade"></div><a id="slide" class="animated fade"></a><aside id="sidebar"><nav id="navigation"><h2>MENU</h2><hr><ul><li> <a href="https://womanonrails.com/">Strona główna</a></li><li> <a href="https://womanonrails.com/pl/workshops">Kursy programowania</a></li><li> <a href="https://womanonrails.com/pl/categories">Kategorie</a></li><li> <a href="https://womanonrails.com/pl/tags">Tagi</a></li><li> <a href="https://womanonrails.com/pl/about">O mnie</a></li><li> <a href="https://bemore.womanonrails.com/">Be more</a></li><li> <a href="/pl/feed.xml" title='Atom/RSS feed'> <span class='svg--rss'><svg role="img" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><title>RSS icon</title><path d="M19.199 24C19.199 13.467 10.533 4.8 0 4.8V0c13.165 0 24 10.835 24 24h-4.801zM3.291 17.415c1.814 0 3.293 1.479 3.293 3.295 0 1.813-1.485 3.29-3.301 3.29C1.47 24 0 22.526 0 20.71s1.475-3.294 3.291-3.295zM15.909 24h-4.665c0-6.169-5.075-11.245-11.244-11.245V8.09c8.727 0 15.909 7.184 15.909 15.91z"/></svg></span> Feed </a></li></ul></nav></aside><header class='blog-background overlay align-center align-middle animated from-bottom' id='masthead' itemscope itemtype='https://schema.org/Organization'> <button class='menu-button animated fade dosearch' title='Wyszukaj'> <span class='svg--search'><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 13"> <g stroke-width="1.5" fill="none"><path d="M11.29 11.71l-4-4"/><circle cx="5" cy="5" r="4"/> </g> </svg></span> </button> <a href="/refactoring-part2" class='language animated fade'> en </a><div class='inner'><div class='container'> <a class='brand' href='/pl/' itemprop='url' role='banner'> <img itemprop='logo' src="https://womanonrails.com/images/womanonrails-square.svg" alt="Woman on Rails Logo" width='120' /><h1 class='blog-title light' itemprop='name'> Woman on Rails</h1></a><h2 class='blog-description light bordered bordered-top' itemprop='description'> Premature optimization is the root of all evil.</h2></div></div><div class="decor-wrapper"> <svg id="header-decor" class="decor bottom" xmlns="https://www.w3.org/2000/svg" version="1.1" viewBox="0 0 100 100" preserveAspectRatio="none"><path class="large left" d="M0 0 L50 50 L0 100" fill="rgba(255,255,255, .1)"></path><path class="large right" d="M100 0 L50 50 L100 100" fill="rgba(255,255,255, .1)"></path><path class="medium left" d="M0 100 L50 50 L0 33.3" fill="rgba(255,255,255, .3)"></path><path class="medium right" d="M100 100 L50 50 L100 33.3" fill="rgba(255,255,255, .3)"></path><path class="small left" d="M0 100 L50 50 L0 66.6" fill="rgba(255,255,255, .5)"></path><path class="small right" d="M100 100 L50 50 L100 66.6" fill="rgba(255,255,255, .5)"></path><path d="M0 99.9 L50 49.9 L100 99.9 L0 99.9" fill="rgba(255,255,255, 1)"></path><path d="M48 52 L50 49 L52 52 L48 52" fill="rgba(255,255,255, 1)"></path> </svg></div></header><div class='content' id='main' itemprop='mainContentOfPage' itemscope itemtype='https://schema.org/WebPageElement' role='main'><div class='container'><div class='row'><div class='applause hidden-xs hidden-sm'> <applause-button color='#c33' multiclap='true' style='width: 58px; height: 58px;' url='https://womanonrails.com/pl/refactoring-part2' /></div><article class='post col-md-8 col-md-offset-2 hentry' itemprop='blogPost' itemscope itemtype='https://schema.org/BlogPosting'><header class='post-header entry-header'><h1 class='post-title text-center hyper lighter bordered-bottom entry-title' itemprop='headline'> Refaktoring w Ruby krok po kroku - część 2</h1><div class='cursive'>Jak zrobić refaktoring? <br> Od kodu zorientowanego obiektowo do kompozycji.</div><div class='post-info text-center small'> <span class='post-tags'> <a data-toggle='tooltip' href="/pl/categories/#refaktoring" title="Other posts from the Refaktoring category" rel="tag">Refaktoring</a> </span> | <span class='post-tags reading-time'> <span class='time'>14</span> min. </span></div></header><div class='post-body bordered-bottom' itemprop='description'><p>Ostatnim razem w artykule <a href="/pl/refactoring-step-by-step">Refactoring w Ruby krok po kroku - część 1</a> przeszłyśmy od kodu proceduralnego do kodu bardziej zorientowanego obiektowo. Tym razem będziemy kontynuować naszą podróż przez refaktoring. Będziemy mówić o małych obiektach zastępujących duże klasy, o kompozycji i o wstrzykiwaniu konkretnych zachowań do obiektów. Zaczynajmy!</p><h1 id="krok-8---bardziej-opisowe-wyniki">Krok 8 - Bardziej opisowe wyniki</h1><p>Ten krok zaczynamy od <a href="https://github.com/womanonrails/poker/blob/46e12428d0d67cb90d17f417147dc936815a69e7/lib/poker/hand.rb" title="Siódmy krok refaktoringu" target="_blank" rel="nofollow noopener noreferrer">kodu</a> i skupimy się na czytelności tej metody:</p><div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">check</span>
  <span class="k">return</span> <span class="mi">9</span> <span class="k">if</span> <span class="n">straight_flush?</span>
  <span class="k">return</span> <span class="mi">8</span> <span class="k">if</span> <span class="n">four_of_a_kind?</span>
  <span class="k">return</span> <span class="mi">7</span> <span class="k">if</span> <span class="n">full_house?</span>
  <span class="k">return</span> <span class="mi">6</span> <span class="k">if</span> <span class="n">flush?</span>
  <span class="k">return</span> <span class="mi">5</span> <span class="k">if</span> <span class="n">straight?</span>
  <span class="k">return</span> <span class="mi">4</span> <span class="k">if</span> <span class="n">three_of_a_kind?</span>
  <span class="k">return</span> <span class="mi">3</span> <span class="k">if</span> <span class="n">two_pair?</span>
  <span class="k">return</span> <span class="mi">2</span> <span class="k">if</span> <span class="n">one_pair?</span>
  <span class="k">return</span> <span class="mi">1</span> <span class="k">if</span> <span class="n">high_card?</span>
  <span class="k">return</span> <span class="mi">0</span>
<span class="k">end</span>
</code></pre></div></div><p>Muszę przyznać, że to dość ważny krok. Kiedy myślimy o czytelności kodu o wiele łatwiej zrozumieć nam tekst <code class="highlighter-rouge">:straight_flush</code> niż zwykłą liczbę <code class="highlighter-rouge">9</code>. W przypadku tekstu nie musisz głęboko wchodzić w szczegóły implementacji kodu by wiedzieć, co on będzie robił. Z drugiej strony, podeszłam do tej zmiany dość egoistycznie. Myślałam tylko o tej klasie bez zastanowienia nad konsekwencjami dla całego systemu. Zmieniłam to, co zwraca metoda <code class="highlighter-rouge">check</code>. W niektórych przypadkach taka zmiana może być bardzo trudna do wprowadzenia lub nawet niemożliwa, przy bieżącym stanie kodu. W moim przypadku zmiana ta wymagała poprawy wszystkich testów. Dlatego musisz być ostrożna i świadoma przy wprowadzaniu takich zmian. W każdym razie, uważam że w moim przypadku zmiana była warta zachodu.</p><p>Kod po zmianie:</p><div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">check</span>
  <span class="k">return</span> <span class="ss">:straight_flush</span> <span class="k">if</span> <span class="n">straight_flush?</span>
  <span class="k">return</span> <span class="ss">:four_of_a_kind</span> <span class="k">if</span> <span class="n">four_of_a_kind?</span>
  <span class="k">return</span> <span class="ss">:full_house</span> <span class="k">if</span> <span class="n">full_house?</span>
  <span class="k">return</span> <span class="ss">:flush</span> <span class="k">if</span> <span class="n">flush?</span>
  <span class="k">return</span> <span class="ss">:straight</span> <span class="k">if</span> <span class="n">straight?</span>
  <span class="k">return</span> <span class="ss">:three_of_a_kind</span> <span class="k">if</span> <span class="n">three_of_a_kind?</span>
  <span class="k">return</span> <span class="ss">:two_pair</span> <span class="k">if</span> <span class="n">two_pair?</span>
  <span class="k">return</span> <span class="ss">:one_pair</span> <span class="k">if</span> <span class="n">one_pair?</span>
  <span class="k">return</span> <span class="ss">:high_card</span> <span class="k">if</span> <span class="n">high_card?</span>
  <span class="k">return</span> <span class="ss">:none</span>
<span class="k">end</span>
</code></pre></div></div><p>Nową wersję kodu możesz znaleźć <a href="https://github.com/womanonrails/poker/blob/4896498a348db52d5c884a522a132eae5b2c4f60/lib/poker/hand.rb" title="Ósmy krok refaktoringu" target="_blank" rel="nofollow noopener noreferrer">tutaj</a></p><h2 id="statystyki">Statystyki:</h2><ul><li><strong>LOC</strong> - 80</li><li><strong>LOT</strong> - 190</li><li><strong>Flog</strong> - 62.5</li><li><strong>Flay</strong> - 0</li><li><strong>Tests</strong> - 104 examples, 0 failures</li></ul><h1 id="krok-9---meta-programowanie">Krok 9 - Meta-programowanie</h1><p>Ten krok jest całkowicie opcjonalny. Zrobiłam go ponieważ nie podobał mi się wygląd metody <code class="highlighter-rouge">check</code> i te powtórzenia wewnątrz. Uważam, że po tej zmianie kod jest dalej czytelny, ale za to krótszy. Niestety nie zawsze tak jest. Czasem meta-programowanie bardzo pogarsza czytelność kodu. Dlatego zawsze jako programistka Ty jesteś odpowiedzialna za swój kod i to Ty musisz wybrać rozwiązanie, które Twoim zadaniem jest lepsze. W moim przypadku stworzyłam tablicę z poprawną kolejnością sprawdzania ręki pokerowej i użyłam jej w metodzie <code class="highlighter-rouge">check</code>.</p><p>Kod przed zmianą:</p><div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">check</span>
  <span class="k">return</span> <span class="ss">:straight_flush</span> <span class="k">if</span> <span class="n">straight_flush?</span>
  <span class="k">return</span> <span class="ss">:four_of_a_kind</span> <span class="k">if</span> <span class="n">four_of_a_kind?</span>
  <span class="k">return</span> <span class="ss">:full_house</span> <span class="k">if</span> <span class="n">full_house?</span>
  <span class="k">return</span> <span class="ss">:flush</span> <span class="k">if</span> <span class="n">flush?</span>
  <span class="k">return</span> <span class="ss">:straight</span> <span class="k">if</span> <span class="n">straight?</span>
  <span class="k">return</span> <span class="ss">:three_of_a_kind</span> <span class="k">if</span> <span class="n">three_of_a_kind?</span>
  <span class="k">return</span> <span class="ss">:two_pair</span> <span class="k">if</span> <span class="n">two_pair?</span>
  <span class="k">return</span> <span class="ss">:one_pair</span> <span class="k">if</span> <span class="n">one_pair?</span>
  <span class="k">return</span> <span class="ss">:high_card</span> <span class="k">if</span> <span class="n">high_card?</span>
  <span class="k">return</span> <span class="ss">:none</span>
<span class="k">end</span>
</code></pre></div></div><p>Kod po zmianie:</p><div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">check</span>
  <span class="vi">@order_checking</span><span class="p">.</span><span class="nf">each</span> <span class="k">do</span> <span class="o">|</span><span class="nb">name</span><span class="o">|</span>
    <span class="n">method_name</span> <span class="o">=</span> <span class="p">(</span><span class="nb">name</span><span class="p">.</span><span class="nf">to_s</span> <span class="o">+</span> <span class="s1">'?'</span><span class="p">).</span><span class="nf">to_sym</span>
    <span class="k">return</span> <span class="nb">name</span> <span class="k">if</span> <span class="nb">send</span><span class="p">(</span><span class="n">method_name</span><span class="p">)</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre></div></div><p>gdzie <code class="highlighter-rouge">@order_checking</code> to tablica ustawień ręki w pokerze.</p><div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>@order_checking = [
  :straight_flush, :four_of_a_kind, :full_house, :flush, :straight,
  :three_of_a_kind, :two_pair, :one_pair, :high_card, :none
]
</code></pre></div></div><p>Cały kod możesz znaleźć <a href="https://github.com/womanonrails/poker/blob/4d649a25af020c7f862b3c6ed964f1b2e73a0f60/lib/poker/hand.rb" title="Dziewiąty krok refaktoringu" target="_blank" rel="nofollow noopener noreferrer">tutaj</a></p><h2 id="statystyki-1">Statystyki</h2><ul><li><strong>LOC</strong> - 82</li><li><strong>LOT</strong> - 190</li><li><strong>Flog</strong> - 59.3</li><li><strong>Flay</strong> - 0</li><li><strong>Tests</strong> - 104 examples, 0 failures</li></ul><h1 id="krok-10---małe-obiekty">Krok 10 - Małe obiekty</h1><p>Ten krok był dość duży ale również ważny. Może nawet najważniejszy. Zaczęłam od zasad <strong>SOLID</strong>. Jeśli nie słyszałaś o tych zasadach lub chciałabyś szybko odświeżyć sobie pamięć, to zajrzyj na <a href="https://pl.wikipedia.org/wiki/SOLID_(programowanie_obiektowe)" title="SOLID (programowanie obiektowe)" target="_blank" rel="nofollow noopener noreferrer">stronę Wiki</a>. Polecam też prezentację <a href="https://www.youtube.com/watch?v=v-2yFMzxqwU" title="Sandy Metz - SOLID Object-Oriented Design" target="_blank" rel="nofollow noopener noreferrer">Sandy Metz - SOLID Object-Oriented Design</a>. Zaczęłam od <strong>S - Single responsibility principle</strong> - zasady pojedynczej odpowiedzialności. Kiedy popatrzysz na kod klasy <code class="highlighter-rouge">Hand</code>, stwierdzisz, że ta klasa wie i robi wszystko. Tak jak już mówiłam w poprzednim artykule ten kod jest bardziej proceduralny niż obiektowy. Zaczęłam, więc wyciągać funkcjonalności jedna po drugiej. Każdy etap był dość podobny do poprzedniego, dlatego pokażę go na jednym przykładzie. Na przykładnie metody <code class="highlighter-rouge">four_of_a_kind</code>:</p><ul><li>Przeniosłam logikę metody <code class="highlighter-rouge">four_of_a_kind</code> do osobnej klasy. Tak, to wytworzy w kodzie pewne powtórzenia, ale jak mówi Sandi <em>duplication is better than a wrong abstraction</em> (powtórzenia są lepsze od złej abstrakcji).</li></ul><div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">module</span> <span class="nn">Poker</span>
  <span class="k">class</span> <span class="nc">FourOfAKind</span>
    <span class="k">def</span> <span class="nf">initialize</span><span class="p">(</span><span class="n">array</span><span class="p">)</span>
      <span class="vi">@array</span> <span class="o">=</span> <span class="n">array</span><span class="p">.</span><span class="nf">sort</span>
      <span class="vi">@figures</span><span class="p">,</span> <span class="vi">@colors</span> <span class="o">=</span> <span class="n">cards_figures_and_colors</span>
      <span class="vi">@frequency</span> <span class="o">=</span> <span class="n">cards_frequency</span><span class="p">.</span><span class="nf">values</span>
    <span class="k">end</span>

    <span class="k">def</span> <span class="nf">check</span>
      <span class="ss">:four_of_a_kind</span> <span class="k">if</span> <span class="vi">@frequency</span><span class="p">.</span><span class="nf">include?</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span>
    <span class="k">end</span>

    <span class="kp">private</span>

    <span class="k">def</span> <span class="nf">cards_figures_and_colors</span>
      <span class="vi">@array</span><span class="p">.</span><span class="nf">map</span> <span class="p">{</span> <span class="o">|</span><span class="n">item</span><span class="o">|</span> <span class="p">[</span><span class="n">item</span> <span class="o">/</span> <span class="mi">4</span><span class="p">,</span> <span class="n">item</span> <span class="o">%</span> <span class="mi">4</span><span class="p">]</span> <span class="p">}.</span><span class="nf">transpose</span>
    <span class="k">end</span>

    <span class="k">def</span> <span class="nf">cards_frequency</span>
      <span class="vi">@figures</span><span class="p">.</span><span class="nf">each_with_object</span><span class="p">(</span><span class="no">Hash</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="mi">0</span><span class="p">))</span> <span class="k">do</span> <span class="o">|</span><span class="n">item</span><span class="p">,</span> <span class="nb">hash</span><span class="o">|</span>
        <span class="nb">hash</span><span class="p">[</span><span class="n">item</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
      <span class="k">end</span>
    <span class="k">end</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre></div></div><ul><li>Tworzę a w późniejszych krokach modyfikuję brzydko wyglądający warunek <code class="highlighter-rouge">if</code> w klasie <code class="highlighter-rouge">Hand</code> tak by obsłużył on nowy kod.</li></ul><div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">check</span>
  <span class="vi">@order_checking</span><span class="p">.</span><span class="nf">each</span> <span class="k">do</span> <span class="o">|</span><span class="nb">name</span><span class="o">|</span>
    <span class="k">if</span> <span class="nb">name</span> <span class="o">==</span> <span class="ss">:four_of_a_kind</span>
      <span class="k">return</span> <span class="nb">name</span> <span class="k">if</span> <span class="no">FourOfAKind</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="vi">@array</span><span class="p">).</span><span class="nf">check</span> <span class="o">==</span> <span class="nb">name</span>
    <span class="k">else</span>
      <span class="n">method_name</span> <span class="o">=</span> <span class="p">(</span><span class="nb">name</span><span class="p">.</span><span class="nf">to_s</span> <span class="o">+</span> <span class="s1">'?'</span><span class="p">).</span><span class="nf">to_sym</span>
      <span class="k">return</span> <span class="nb">name</span> <span class="k">if</span> <span class="nb">send</span><span class="p">(</span><span class="n">method_name</span><span class="p">)</span>
    <span class="k">end</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre></div></div><ul><li>Przygotowuję testy dla nowej klasy. Tak, powieliłam już istniejące testy dla metody <code class="highlighter-rouge">check</code> w tej nowej klasie. Na tą chwilę musi to tak zostać.</li></ul><div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">require</span> <span class="s1">'spec_helper'</span>

<span class="n">describe</span> <span class="no">Poker</span><span class="o">::</span><span class="no">FourOfAKind</span> <span class="k">do</span>
  <span class="p">[</span>
    <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">],</span>
    <span class="p">[</span><span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">7</span><span class="p">],</span>
    <span class="p">[</span><span class="mi">8</span><span class="p">,</span> <span class="mi">9</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">11</span><span class="p">],</span>
    <span class="p">[</span><span class="mi">12</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">13</span><span class="p">,</span> <span class="mi">14</span><span class="p">,</span> <span class="mi">15</span><span class="p">],</span>
    <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="mi">17</span><span class="p">,</span> <span class="mi">18</span><span class="p">,</span> <span class="mi">19</span><span class="p">],</span>
    <span class="p">[</span><span class="mi">20</span><span class="p">,</span> <span class="mi">21</span><span class="p">,</span> <span class="mi">22</span><span class="p">,</span> <span class="mi">23</span><span class="p">,</span> <span class="mi">0</span><span class="p">].</span><span class="nf">shuffle</span><span class="p">,</span>
    <span class="p">[</span><span class="mi">24</span><span class="p">,</span> <span class="mi">25</span><span class="p">,</span> <span class="mi">26</span><span class="p">,</span> <span class="mi">27</span><span class="p">,</span> <span class="mi">0</span><span class="p">].</span><span class="nf">shuffle</span><span class="p">,</span>
    <span class="p">[</span><span class="mi">28</span><span class="p">,</span> <span class="mi">29</span><span class="p">,</span> <span class="mi">30</span><span class="p">,</span> <span class="mi">31</span><span class="p">,</span> <span class="mi">0</span><span class="p">].</span><span class="nf">shuffle</span><span class="p">,</span>
    <span class="p">[</span><span class="mi">32</span><span class="p">,</span> <span class="mi">33</span><span class="p">,</span> <span class="mi">34</span><span class="p">,</span> <span class="mi">35</span><span class="p">,</span> <span class="mi">0</span><span class="p">].</span><span class="nf">shuffle</span><span class="p">,</span>
    <span class="p">[</span><span class="mi">36</span><span class="p">,</span> <span class="mi">37</span><span class="p">,</span> <span class="mi">38</span><span class="p">,</span> <span class="mi">39</span><span class="p">,</span> <span class="mi">0</span><span class="p">].</span><span class="nf">shuffle</span>
  <span class="p">].</span><span class="nf">each</span> <span class="k">do</span> <span class="o">|</span><span class="n">cards</span><span class="o">|</span>
    <span class="n">it</span> <span class="s2">"detects four_of_a_kind for </span><span class="si">#{</span><span class="n">cards</span><span class="si">}</span><span class="s2">"</span> <span class="k">do</span>
      <span class="n">hand</span> <span class="o">=</span> <span class="n">described_class</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="n">cards</span><span class="p">)</span>
      <span class="n">expect</span><span class="p">(</span><span class="n">hand</span><span class="p">.</span><span class="nf">check</span><span class="p">).</span><span class="nf">to</span> <span class="n">eq</span> <span class="ss">:four_of_a_kind</span>
    <span class="k">end</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre></div></div><p>Podczas tego procesu zrobiłam jeszcze jedną rzecz. Wstrzyknęłam kolejność sprawdzania ręki pokerowej do inicjalizera klasy <code class="highlighter-rouge">Hand</code>. <code class="highlighter-rouge">ORDER_CHECKING</code> to stała, którą można traktować jako konfigurację i wyciągnąć do osobnego pliku jeżeli zajdzie taka potrzeba. Zrobiłam to na wypadek gdybym chciała szybko zmienić kolejność sprawdzania tego, co gracz ma w ręce w testach lub w aplikacji.</p><div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">initialize</span><span class="p">(</span><span class="n">array</span><span class="p">,</span> <span class="n">order_checking</span> <span class="o">=</span> <span class="no">ORDER_CHECKING</span><span class="p">)</span>
  <span class="o">...</span>
<span class="k">end</span>
</code></pre></div></div><p>Kod dla tego etapu znajdziesz <a href="https://github.com/womanonrails/poker/tree/0c5d6850d40f899d98ff531e4a2b948d469c3d84/lib/poker" title="Dziesiąty krok refaktoringu" target="_blank" rel="nofollow noopener noreferrer">tutaj</a>. Został on powtórzony przeze mnie dla każdej ręki pokerowej. Po każdej iteracji wszystkie testy przechodziły. Jeżeli chciałabyś zobaczyć jak to wygląda z większej perspektywy, to zajrzyj <a href="https://github.com/womanonrails/poker/tree/08631288c747a2a9fda3d986f4046e9e363ea027/lib/poker" title="3 klasy stworzone na bazie powyższych kroków" target="_blank" rel="nofollow noopener noreferrer">tutaj</a>. W tym miejscu istnieją już 3 klasy stworzone na bazie powyższych kroków.</p><h2 id="statystyki-2">Statystyki</h2><ul><li><strong>LOC</strong> - 85</li><li><strong>LOT</strong> - 200</li><li><strong>Flog</strong> - 65.5</li><li><strong>Flay</strong> - 0</li><li><strong>Tests</strong> - 116 examples, 0 failures</li></ul><h1 id="krok-11---usuwanie-powieleń">Krok 11 - Usuwanie powieleń</h1><p>W tym kroku zajęłam się usuwaniem analogii w kodzie. A muszę przyznać, że było tego dość sporo. Za każdym razem przy tworzeniu nowej klasy zmieniałam tylko dwie rzeczy: nazwę klasy i jedną linię w metodzie <code class="highlighter-rouge">check</code>. By pozbyć się tego powielenia, musiałam wydzielić jakieś zachowanie, może metodę lub nawet klasę, która zajmie się pewnego rodzaju sortowaniem kart i będzie miała wiedzę na temat kolorów i figur. Zdecydowałam, że stworzę normalizację kart. Dzięki temu powstała klasa <code class="highlighter-rouge">CardsNormalization</code>, która jest pewnego rodzaju reprezentacją dość ogólnej klasy <code class="highlighter-rouge">Normalization</code>. Możesz zapytać mnie dlaczego stworzyłam 2 klasy, kiedy potrzebuje tylko jedną? No cóż, mam przeczucie, że tworzę mały interfejs, który będzie miał wiele różnych reprezentacji. Na tą chwilę istnieje tylko jedna reprezentacja, ale kto wie, co będzie w przyszłości? Przykładem innej reprezentacji (innej normalizacji) jest gra w kości. Zasady są bardzo podobne, ale normalizacja wprowadzanych danych będzie wyglądać inaczej. Kod tych dwóch nowych klas znajdziesz <a href="https://github.com/womanonrails/poker/tree/a668a538cb86dd17e946157c5d62373fe2266c0e/lib" title="Jedenasty krok refaktoringu" target="_blank" rel="nofollow noopener noreferrer">tutaj</a>. Kod który był powielony w nowych klasach znalazł się w klasie <code class="highlighter-rouge">Normalization</code>:</p><div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">class</span> <span class="nc">Normalization</span>
  <span class="nb">attr_reader</span> <span class="ss">:figures</span><span class="p">,</span> <span class="ss">:colors</span><span class="p">,</span> <span class="ss">:figures_frequency</span>
  <span class="k">def</span> <span class="nf">initialize</span><span class="p">(</span><span class="n">array</span><span class="p">)</span>
    <span class="vi">@array</span> <span class="o">=</span> <span class="n">array</span><span class="p">.</span><span class="nf">sort</span>
    <span class="vi">@figures</span> <span class="o">=</span> <span class="n">prepare_figures</span>
    <span class="vi">@colors</span> <span class="o">=</span> <span class="n">prepare_colors</span>
    <span class="vi">@figures_frequency</span> <span class="o">=</span> <span class="n">prepare_figures_frequency</span><span class="p">.</span><span class="nf">values</span>
  <span class="k">end</span>
  <span class="kp">private</span>
  <span class="k">def</span> <span class="nf">prepare_colors</span>
    <span class="vi">@array</span>
  <span class="k">end</span>
  <span class="k">def</span> <span class="nf">prepare_figures</span>
    <span class="vi">@array</span>
  <span class="k">end</span>
  <span class="k">def</span> <span class="nf">prepare_figures_frequency</span>
    <span class="vi">@figures</span><span class="p">.</span><span class="nf">each_with_object</span><span class="p">(</span><span class="no">Hash</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="mi">0</span><span class="p">))</span> <span class="k">do</span> <span class="o">|</span><span class="n">item</span><span class="p">,</span> <span class="nb">hash</span><span class="o">|</span>
      <span class="nb">hash</span><span class="p">[</span><span class="n">item</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
    <span class="k">end</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre></div></div><p>a tutaj klasa <code class="highlighter-rouge">CardsNormalization</code>:</p><div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">class</span> <span class="nc">CardsNormalization</span> <span class="o">&lt;</span> <span class="no">Normalization</span>
  <span class="kp">private</span>
  <span class="k">def</span> <span class="nf">prepare_colors</span>
    <span class="vi">@array</span><span class="p">.</span><span class="nf">map</span> <span class="p">{</span> <span class="o">|</span><span class="n">item</span><span class="o">|</span> <span class="n">item</span> <span class="o">%</span> <span class="mi">4</span> <span class="p">}</span>
  <span class="k">end</span>
  <span class="k">def</span> <span class="nf">prepare_figures</span>
    <span class="vi">@array</span><span class="p">.</span><span class="nf">map</span> <span class="p">{</span> <span class="o">|</span><span class="n">item</span><span class="o">|</span> <span class="n">item</span> <span class="o">/</span> <span class="mi">4</span> <span class="p">}</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre></div></div><p>Podczas tego kroku zrobiłam jeszcze jedną rzecz. Wstrzyknęłam normalizację jako argument do inicjalizera klasy <code class="highlighter-rouge">Hand</code>:</p><div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">initialize</span><span class="p">(</span><span class="n">array</span><span class="p">,</span> <span class="n">order_checking</span> <span class="o">=</span> <span class="no">ORDER_CHECKING</span><span class="p">,</span> <span class="n">normalization</span> <span class="o">=</span> <span class="no">CardsNormalization</span><span class="p">)</span>
</code></pre></div></div><p>Po tych wszystkich zmianach moja klasa <code class="highlighter-rouge">OnePair</code> wygląda następująco:</p><div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">module</span> <span class="nn">Poker</span>
  <span class="k">class</span> <span class="nc">OnePair</span>
    <span class="k">def</span> <span class="nf">initialize</span><span class="p">(</span><span class="n">array</span><span class="p">,</span> <span class="n">normalization</span> <span class="o">=</span> <span class="no">Normalization</span><span class="p">)</span>
      <span class="vi">@normalize_array</span> <span class="o">=</span> <span class="n">normalization</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="n">array</span><span class="p">)</span>
    <span class="k">end</span>

    <span class="k">def</span> <span class="nf">check</span>
      <span class="ss">:one_pair</span> <span class="k">if</span> <span class="vi">@normalize_array</span><span class="p">.</span><span class="nf">figures_frequency</span><span class="p">.</span><span class="nf">include?</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
    <span class="k">end</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre></div></div><p>Tylko jedna metoda wygląda okropnie. To metoda <code class="highlighter-rouge">check</code>. Posiada ona teraz wiele warunków. Wiem jednak, że jest to stan przejściowy. Zajmę się tą metodą, jak tylko zakończę wyciąganie kolejnych funkcjonalności z klasy <code class="highlighter-rouge">Hand</code>. Na tą chwilę metoda ta wygląda tak:</p><div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">check</span>
  <span class="vi">@order_checking</span><span class="p">.</span><span class="nf">each</span> <span class="k">do</span> <span class="o">|</span><span class="nb">name</span><span class="o">|</span>
    <span class="k">if</span> <span class="p">[</span><span class="ss">:one_pair</span><span class="p">].</span><span class="nf">include?</span> <span class="nb">name</span>
      <span class="n">class_name</span>  <span class="o">=</span> <span class="s1">'Poker::'</span> <span class="o">+</span> <span class="nb">name</span><span class="p">.</span><span class="nf">to_s</span><span class="p">.</span><span class="nf">split</span><span class="p">(</span><span class="s1">'_'</span><span class="p">).</span><span class="nf">collect</span><span class="p">(</span><span class="o">&amp;</span><span class="ss">:capitalize</span><span class="p">).</span><span class="nf">join</span>
      <span class="k">return</span> <span class="nb">name</span> <span class="k">if</span> <span class="no">Object</span><span class="p">.</span><span class="nf">const_get</span><span class="p">(</span><span class="n">class_name</span><span class="p">).</span><span class="nf">new</span><span class="p">(</span><span class="vi">@array</span><span class="p">,</span> <span class="vi">@normalization</span><span class="p">).</span><span class="nf">check</span> <span class="o">==</span> <span class="nb">name</span>
    <span class="k">end</span>
    <span class="k">if</span> <span class="p">[</span><span class="ss">:four_of_a_kind</span><span class="p">,</span> <span class="ss">:three_of_a_kind</span><span class="p">,</span> <span class="ss">:one_pair</span><span class="p">].</span><span class="nf">include?</span> <span class="nb">name</span>
      <span class="n">class_name</span>  <span class="o">=</span> <span class="s1">'Poker::'</span> <span class="o">+</span> <span class="nb">name</span><span class="p">.</span><span class="nf">to_s</span><span class="p">.</span><span class="nf">split</span><span class="p">(</span><span class="s1">'_'</span><span class="p">).</span><span class="nf">collect</span><span class="p">(</span><span class="o">&amp;</span><span class="ss">:capitalize</span><span class="p">).</span><span class="nf">join</span>
      <span class="k">return</span> <span class="nb">name</span> <span class="k">if</span> <span class="no">Object</span><span class="p">.</span><span class="nf">const_get</span><span class="p">(</span><span class="n">class_name</span><span class="p">).</span><span class="nf">new</span><span class="p">(</span><span class="vi">@array</span><span class="p">).</span><span class="nf">check</span> <span class="o">==</span> <span class="nb">name</span>
    <span class="k">else</span>
      <span class="n">method_name</span> <span class="o">=</span> <span class="p">(</span><span class="nb">name</span><span class="p">.</span><span class="nf">to_s</span> <span class="o">+</span> <span class="s1">'?'</span><span class="p">).</span><span class="nf">to_sym</span>
      <span class="k">return</span> <span class="nb">name</span> <span class="k">if</span> <span class="nb">send</span><span class="p">(</span><span class="n">method_name</span><span class="p">)</span>
    <span class="k">end</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre></div></div><p>Następnie, powtórzyłam to samo rozumowanie dla reszty istniejących klas. Użyłam <code class="highlighter-rouge">CardsNormalization</code> dla <code class="highlighter-rouge">FourOfAKind</code> i <code class="highlighter-rouge">ThreeOfAKind</code>. Kod znajdziesz <a href="https://github.com/womanonrails/poker/tree/87891306fe875bd415554a6eb5ebc0b46f893c9d/lib/poker" title="Kod po jedenastym kroku refaktoringu" target="_blank" rel="nofollow noopener noreferrer">tutaj</a>.</p><h2 id="statystyki-3">Statystyki:</h2><ul><li><strong>LOC</strong> - 87</li><li><strong>LOT</strong> - 200</li><li><strong>Flog</strong> - 82.5</li><li><strong>Flog total</strong> - 122.4</li><li><strong>Flay</strong> - 0</li><li><strong>Tests</strong> - 124 examples, 0 failures</li></ul><h1 id="krok-12---usunięcie-kolejnych-powtórzeń">Krok 12 - Usunięcie kolejnych powtórzeń</h1><p>Tym razem skupiłam się na innych powtórzeniach w nowych klasach. W kilku miejscach sprawdzam podobny warunek: <code class="highlighter-rouge">@normalize_array.figures_frequency.include?(4)</code> zmienia się tylko liczba. Jest to dla mnie pewnego rodzaju <em>zasada</em>. Sprawdzamy czy w kartach mamy 2, 3, lub 4 te same figury. Zdecydowałam, że stworzę klasę <code class="highlighter-rouge">FrequencyRule</code> a tak wygląda jej kod:</p><div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">module</span> <span class="nn">Rules</span>
  <span class="k">class</span> <span class="nc">FrequencyRule</span>
    <span class="k">def</span> <span class="nf">initialize</span><span class="p">(</span><span class="n">frequency_array</span><span class="p">,</span> <span class="n">count</span><span class="p">)</span>
      <span class="vi">@frequency_array</span> <span class="o">=</span> <span class="n">frequency_array</span>
      <span class="vi">@count</span> <span class="o">=</span> <span class="n">count</span>
    <span class="k">end</span>

    <span class="k">def</span> <span class="nf">check?</span>
      <span class="vi">@frequency_array</span><span class="p">.</span><span class="nf">include?</span><span class="p">(</span><span class="vi">@count</span><span class="p">)</span>
    <span class="k">end</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre></div></div><p>następnie dodałam <code class="highlighter-rouge">@rule = Rules::FrequencyRule.new(@normalize_array.figures_frequency, 3)</code> do inicjalizera i użyłam metody <code class="highlighter-rouge">@rule.check?</code> zamiast <code class="highlighter-rouge">@normalize_array.figures_frequency.include?(3)</code>. Tak wygląda klasa <code class="highlighter-rouge">ThreeOfAKind</code> po tej zmianie:</p><div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">class</span> <span class="nc">ThreeOfAKind</span>
  <span class="k">def</span> <span class="nf">initialize</span><span class="p">(</span><span class="n">array</span><span class="p">,</span> <span class="n">normalization</span> <span class="o">=</span> <span class="no">Normalization</span><span class="p">)</span>
    <span class="vi">@normalize_array</span> <span class="o">=</span> <span class="n">normalization</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="n">array</span><span class="p">)</span>
    <span class="vi">@rule</span> <span class="o">=</span> <span class="no">Rules</span><span class="o">::</span><span class="no">FrequencyRule</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="vi">@normalize_array</span><span class="p">.</span><span class="nf">figures_frequency</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
  <span class="k">end</span>

  <span class="k">def</span> <span class="nf">check</span>
    <span class="ss">:three_of_a_kind</span> <span class="k">if</span> <span class="vi">@rule</span><span class="p">.</span><span class="nf">check?</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre></div></div><p>Cały kod wygląda <a href="https://github.com/womanonrails/poker/tree/d66590842ef194a9218dea70ccd083212b5d43b2/lib" title="Dwunasty krok refaktoringu" target="_blank" rel="nofollow noopener noreferrer">tak</a>. Po tej zmianie i napisaniu nowych testów, wszystkie nowe i stare testy przechodzą.</p><h2 id="statystyki-4">Statystyki</h2><ul><li><strong>LOC</strong> - 87</li><li><strong>LOT</strong> - 161</li><li><strong>Flog</strong> - 82.5</li><li><strong>Flog total</strong> - 134.9</li><li><strong>Flay</strong> - 0</li><li><strong>Tests</strong> - 95 examples, 0 failures</li></ul><h1 id="krok-13---łączenie-wielu-zasad">Krok 13 - Łączenie wielu zasad</h1><p>Teraz interesująca sprawa. Czas na fula. W tym przypadku potrzebujemy sprawdzić czy mamy 3 i 2 te same figury w tym samym czasie. Tak jak tutaj: 2♠ 2♣ <span class="red-text">2♥ 3♥ 3♦</span>. Musimy więc sprawdzić tą samą zasadę dla dwóch i trzech tych samych figur. To dobry czas by stworzyć klasę, która będzie łączyć wiele różnych zasad. Nazwałam ją <code class="highlighter-rouge">RulesFactory</code>. Kod wygląda następująco:</p><div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">class</span> <span class="nc">RulesFactory</span>
  <span class="k">def</span> <span class="nf">initialize</span><span class="p">(</span><span class="o">*</span><span class="n">rules</span><span class="p">)</span>
    <span class="vi">@rules</span> <span class="o">=</span> <span class="n">rules</span>
  <span class="k">end</span>

  <span class="k">def</span> <span class="nf">check?</span>
    <span class="vi">@rules</span><span class="p">.</span><span class="nf">each</span> <span class="k">do</span> <span class="o">|</span><span class="n">rule</span><span class="o">|</span>
      <span class="k">return</span> <span class="kp">false</span> <span class="k">unless</span> <span class="n">rule</span><span class="p">.</span><span class="nf">check?</span>
    <span class="k">end</span>
    <span class="kp">true</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre></div></div><p>A tak wygląda kod klasy <code class="highlighter-rouge">FullHouse</code> (karety):</p><div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">module</span> <span class="nn">Poker</span>
  <span class="k">class</span> <span class="nc">FullHouse</span>
    <span class="k">def</span> <span class="nf">initialize</span><span class="p">(</span><span class="n">array</span><span class="p">,</span> <span class="n">normalization</span> <span class="o">=</span> <span class="no">Normalization</span><span class="p">)</span>
      <span class="vi">@normalize_array</span> <span class="o">=</span> <span class="n">normalization</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="n">array</span><span class="p">)</span>
      <span class="n">rule1</span> <span class="o">=</span> <span class="no">Rules</span><span class="o">::</span><span class="no">FrequencyRule</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="vi">@normalize_array</span><span class="p">.</span><span class="nf">figures_frequency</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
      <span class="n">rule2</span> <span class="o">=</span> <span class="no">Rules</span><span class="o">::</span><span class="no">FrequencyRule</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="vi">@normalize_array</span><span class="p">.</span><span class="nf">figures_frequency</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
      <span class="vi">@rules</span> <span class="o">=</span> <span class="no">RulesFactory</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="n">rule1</span><span class="p">,</span> <span class="n">rule2</span><span class="p">)</span>
    <span class="k">end</span>

    <span class="k">def</span> <span class="nf">check</span>
      <span class="ss">:full_house</span> <span class="k">if</span> <span class="vi">@rules</span><span class="p">.</span><span class="nf">check?</span>
    <span class="k">end</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre></div></div><p>Widzisz schemat? Oczywiście, trzeba jeszcze zrobić parę ulepszeń w klasie <code class="highlighter-rouge">Hand</code>. Dopisać nowe testy i sprawdzić czy przechodzą. Cały kod jest dostępny <a href="https://github.com/womanonrails/poker/tree/d18cf1f273c9fdcb97e21067d3411938beefdf36/lib" title="Trzynasty krok refaktoringu" target="_blank" rel="nofollow noopener noreferrer">tutaj</a>.</p><h1 id="krok-14---powtarzanie-kroków">Krok 14 - Powtarzanie kroków</h1><p>Nadszedł czas by powtórzyć krok, który już wcześniej opisałam. Tworzymy nowe zasady: <code class="highlighter-rouge">StraightnessRule</code>, <code class="highlighter-rouge">FlushnessRule</code> i <code class="highlighter-rouge">RoyalnessRule</code>. Tworzymy nowe klasy: <code class="highlighter-rouge">Straight</code>, <code class="highlighter-rouge">Flush</code> i <code class="highlighter-rouge">RoyalFlush</code>. Kod po tej zmianie znajduje się <a href="https://github.com/womanonrails/poker/tree/0985c071c87de56c8c49307d6d20963aced7ff79/lib" title="Czternasty krok refaktoringu" target="_blank" rel="nofollow noopener noreferrer">tutaj</a>.</p><p>Chciałabym wspomnieć o jednej magicznej sprawie. Kiedy zaczęłam tworzyć małe klasy z pojedyńczymi odpowiedzialnościami, klasy te stały się w dość proste. Dzięki temu można używać ich w nieoczekiwany sposób. Oto przykład:</p><div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">module</span> <span class="nn">Rules</span>
  <span class="k">class</span> <span class="nc">FlushnessRule</span>
    <span class="k">def</span> <span class="nf">initialize</span><span class="p">(</span><span class="n">color_array</span><span class="p">)</span>
      <span class="vi">@color_array</span> <span class="o">=</span> <span class="n">color_array</span>
    <span class="k">end</span>
    <span class="k">def</span> <span class="nf">check?</span>
      <span class="vi">@color_array</span><span class="p">.</span><span class="nf">uniq</span><span class="p">.</span><span class="nf">size</span> <span class="o">==</span> <span class="mi">1</span>
    <span class="k">end</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre></div></div><p>To co klasa powinna robić:</p><div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">rule</span> <span class="o">=</span> <span class="no">FlushnessRule</span><span class="p">.</span><span class="nf">new</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">])</span>
 <span class="o">=&gt;</span> <span class="c1">#&lt;FlushnessRule:0x00000001eced60 @color_array=[1, 1]&gt;</span>
<span class="n">rule</span><span class="p">.</span><span class="nf">check?</span>
 <span class="o">=&gt;</span> <span class="kp">true</span>
</code></pre></div></div><p>to co może robić:</p><div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">rule</span> <span class="o">=</span> <span class="no">FlushnessRule</span><span class="p">.</span><span class="nf">new</span><span class="p">([</span><span class="s1">'#fff'</span><span class="p">,</span><span class="s1">'#fff'</span><span class="p">])</span>
 <span class="o">=&gt;</span> <span class="c1">#&lt;FlushnessRule:0x00000001ebc020 @color_array=["#fff", "#fff"]&gt;</span>
<span class="n">rule</span><span class="p">.</span><span class="nf">check?</span>
 <span class="o">=&gt;</span> <span class="kp">true</span>
</code></pre></div></div><p>Kiedy tworzyłam tą klasę nie przypuszczałam, że będę mogła ją wykorzystać w taki sposób. Nie myślałam, że będzie się ona nadawać do obsługi zarówno tablic jak i ciągów znaków. Wiem, że to poniekąd jest to zasługa samego języka Ruby i jego <a href="https://pl.wikipedia.org/wiki/Duck_typing" title="Duck typing in Ruby" target="_blank" rel="nofollow noopener noreferrer"><strong>duck typing’u</strong></a> ale myślę, że też prostoty kodu.</p><h2 id="statystyki-5">Statystyki:</h2><ul><li><strong>LOC</strong> - 94</li><li><strong>LOT</strong> - 171</li><li><strong>Flog</strong> - 69.7</li><li><strong>Flog total</strong> - 191.2</li><li><strong>Flay</strong> - 0</li><li><strong>Tests</strong> - 142 examples, 0 failures</li></ul><h1 id="krok-15---zasada-dla-niczego">Krok 15 - Zasada dla Niczego</h1><p>Kiedy grasz w pokera możesz mieć w ręce jedno z punktowanych ustawień figur lub po prostu nic. To “nic” trzeba obsłużyć w kodzie. Stworzyłam więc klasę dla “niczego” - <code class="highlighter-rouge">None</code>. Dodatkowo zrobiłam też trochę porządków w klasie <code class="highlighter-rouge">Hand</code>.</p><div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">module</span> <span class="nn">Poker</span>
  <span class="k">class</span> <span class="nc">None</span>
    <span class="k">def</span> <span class="nf">initialize</span><span class="p">(</span><span class="n">array</span><span class="p">,</span> <span class="n">normalization</span> <span class="o">=</span> <span class="no">Normalization</span><span class="p">)</span>
      <span class="vi">@normalize_array</span> <span class="o">=</span> <span class="n">normalization</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="n">array</span><span class="p">)</span>
    <span class="k">end</span>

    <span class="k">def</span> <span class="nf">check</span>
      <span class="ss">:none</span>
    <span class="k">end</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre></div></div><p>Cały kod związany z tym krokiem znajdziesz <a href="https://github.com/womanonrails/poker/tree/03a356a42afed39fffd98ceff0b7b1311f7b05ec/lib" title="Piętnasty krok refaktoringu" target="_blank" rel="nofollow noopener noreferrer">tutaj</a>. Jak zawsze wszystkie testy po tym kroku przechodzą.</p><h2 id="statystyki-6">Statystyki</h2><ul><li><strong>LOC</strong> - 55</li><li><strong>LOT</strong> - 171</li><li><strong>Flog</strong> - 56.0</li><li><strong>Flog total</strong> - 180.8</li><li><strong>Flay</strong> - 0</li><li><strong>Tests</strong> - 145 examples, 0 failures</li></ul><h1 id="krok-16---multifrequencyrule">Krok 16 - MultiFrequencyRule</h1><p>To będzie nasz ostatni krok. Możesz wierzyć lub nie ale najtrudniejsza do sprawdzenia zasada to dwie pary. Do tej pory stworzyłyśmy zasadę do sprawdzania liczby tych samych figur w ręce - <code class="highlighter-rouge">FrequencyRule</code>. Ta zasada jednak tu nie zadziała, ponieważ chcemy sprawdzić czy mamy 2 pary. Musimy więc stworzyć inną zasadę, inną logikę. Postanowiłam nazwać ją <code class="highlighter-rouge">MultiFrequencyRule</code>:</p><div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">module</span> <span class="nn">Rules</span>
  <span class="k">class</span> <span class="nc">MultiFrequencyRule</span>
    <span class="k">def</span> <span class="nf">initialize</span><span class="p">(</span><span class="n">frequency_array</span><span class="p">,</span> <span class="n">count</span><span class="p">,</span> <span class="n">times</span> <span class="o">=</span> <span class="mi">1</span><span class="p">)</span>
      <span class="vi">@frequency_array</span> <span class="o">=</span> <span class="n">frequency_array</span>
      <span class="vi">@count</span> <span class="o">=</span> <span class="n">count</span>
      <span class="vi">@times</span> <span class="o">=</span> <span class="n">times</span>
    <span class="k">end</span>

    <span class="k">def</span> <span class="nf">check?</span>
      <span class="n">selected_frequency</span> <span class="o">=</span> <span class="vi">@frequency_array</span><span class="p">.</span><span class="nf">reject</span> <span class="p">{</span> <span class="o">|</span><span class="n">number</span><span class="o">|</span> <span class="n">number</span> <span class="o">&lt;</span> <span class="vi">@count</span> <span class="p">}</span>
      <span class="n">selected_frequency</span><span class="p">.</span><span class="nf">count</span> <span class="o">&gt;=</span> <span class="vi">@times</span>
    <span class="k">end</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre></div></div><p>Tym razem sprawdzamy tylko wybraną liczbę wystąpień w <code class="highlighter-rouge">@frequency_array</code>. Ile razy ona pojawia się w tej tablicy. Chwila! Jeżeli mamy taką kombinację kart 2♠ 2♣ <span class="red-text">2♥ 3♥ 3♦</span> mamy w ręce fula ale również dwie pary. Zasada do sprawdzania czy mamy w naszej ręce dwie pary też powinna zwrócić <code class="highlighter-rouge">true</code>. Dlatego też sprawdzamy warunek: <code class="highlighter-rouge">number &lt; @count</code> i usuwamy te elementy z tablicy. Kod dla tego kroku znajdziesz <a href="https://github.com/womanonrails/poker/blob/6a3af1c900c88477097ac00d405fef59866eb06b/lib/rules/multi_frequency_rule.rb" title="Kod klasy MultiFrequencyRule" target="_blank" rel="nofollow noopener noreferrer">tutaj</a>.</p><p><strong>Uwaga!</strong> Jeżeli przyjrzysz się bliżej, to zauważysz, że ten kod ma pewien problem. Przy ustawieniu 2♠ 2♣ <span class="red-text">2♥ 2♦ 3♥</span> też mamy dwie pary. Zmodyfikujmy naszą metodę <code class="highlighter-rouge">check?</code>:</p><div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">check?</span>
  <span class="n">selected_frequency</span> <span class="o">=</span> <span class="vi">@frequency_array</span><span class="p">.</span><span class="nf">map</span> <span class="p">{</span> <span class="o">|</span><span class="n">number</span><span class="o">|</span> <span class="n">number</span> <span class="o">/</span> <span class="vi">@count</span> <span class="p">}</span>
  <span class="n">selected_frequency</span><span class="p">.</span><span class="nf">sum</span> <span class="o">&gt;=</span> <span class="vi">@times</span>
<span class="k">end</span>
</code></pre></div></div><p>Nareszcie możemy całkowicie wyczyścić logikę klasy <code class="highlighter-rouge">Hand</code>. Możemy też zastąpić klasę <code class="highlighter-rouge">FrequencyRule</code>, klasą <code class="highlighter-rouge">MultiFrequencyRule</code>, która jest bardziej ogólna. Kod znajdziesz <a href="https://github.com/womanonrails/poker/tree/277d2893ffac1318c2a64fca2704e1c8258856e1/lib" title="Szesnasty krok refaktoringu" target="_blank" rel="nofollow noopener noreferrer">tutaj</a>. Sprawdźmy jak wygląda teraz nasza klasa <code class="highlighter-rouge">Hand</code>:</p><div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">module</span> <span class="nn">Poker</span>
  <span class="no">ORDER_CHECKING</span> <span class="o">=</span> <span class="p">[</span>
    <span class="ss">:royal_flush</span><span class="p">,</span> <span class="ss">:straight_flush</span><span class="p">,</span> <span class="ss">:four_of_a_kind</span><span class="p">,</span> <span class="ss">:full_house</span><span class="p">,</span> <span class="ss">:flush</span><span class="p">,</span>
    <span class="ss">:straight</span><span class="p">,</span> <span class="ss">:three_of_a_kind</span><span class="p">,</span> <span class="ss">:two_pair</span><span class="p">,</span> <span class="ss">:one_pair</span><span class="p">,</span> <span class="ss">:high_card</span><span class="p">,</span> <span class="ss">:none</span>
  <span class="p">].</span><span class="nf">freeze</span>

  <span class="c1"># Poker hand</span>
  <span class="k">class</span> <span class="nc">Hand</span>
    <span class="k">def</span> <span class="nf">initialize</span><span class="p">(</span>
      <span class="n">array</span><span class="p">,</span>
      <span class="n">order_checking</span> <span class="o">=</span> <span class="no">ORDER_CHECKING</span><span class="p">,</span>
      <span class="n">normalization</span> <span class="o">=</span> <span class="no">CardsNormalization</span>
    <span class="p">)</span>
      <span class="vi">@array</span> <span class="o">=</span> <span class="n">array</span><span class="p">.</span><span class="nf">sort</span>
      <span class="vi">@order_checking</span> <span class="o">=</span> <span class="n">order_checking</span>
      <span class="vi">@normalization</span> <span class="o">=</span> <span class="n">normalization</span>
    <span class="k">end</span>

    <span class="k">def</span> <span class="nf">check</span>
      <span class="vi">@order_checking</span><span class="p">.</span><span class="nf">each</span> <span class="k">do</span> <span class="o">|</span><span class="nb">name</span><span class="o">|</span>
        <span class="k">return</span> <span class="nb">name</span> <span class="k">if</span> <span class="n">class_name</span><span class="p">(</span><span class="nb">name</span><span class="p">).</span><span class="nf">check</span> <span class="o">==</span> <span class="nb">name</span>
      <span class="k">end</span>
    <span class="k">end</span>

    <span class="kp">private</span>

    <span class="k">def</span> <span class="nf">class_name</span><span class="p">(</span><span class="nb">name</span><span class="p">)</span>
      <span class="n">class_name</span> <span class="o">=</span> <span class="s1">'Poker::'</span> <span class="o">+</span> <span class="nb">name</span><span class="p">.</span><span class="nf">to_s</span><span class="p">.</span><span class="nf">split</span><span class="p">(</span><span class="s1">'_'</span><span class="p">).</span><span class="nf">collect</span><span class="p">(</span><span class="o">&amp;</span><span class="ss">:capitalize</span><span class="p">).</span><span class="nf">join</span>
      <span class="no">Object</span><span class="p">.</span><span class="nf">const_get</span><span class="p">(</span><span class="n">class_name</span><span class="p">).</span><span class="nf">new</span><span class="p">(</span><span class="vi">@array</span><span class="p">,</span> <span class="vi">@normalization</span><span class="p">)</span>
    <span class="k">end</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre></div></div><p>Jestem dumna z tej klasy. Jeżeli chciałabyś porównać tą klasę z początkową implementacją zajrzyj <a href="https://github.com/womanonrails/poker/blob/55c9ae0ab921f7aa95bb7e47676d87b970a32033/lib/poker/hand.rb" title="Pierwsza wersja kodu klasy Poker" target="_blank" rel="nofollow noopener noreferrer">tutaj</a>.</p><h2 id="statystyki-końcowe">Statystyki końcowe:</h2><ul><li><strong>LOC</strong> - 37</li><li><strong>LOT</strong> - 173</li><li><strong>Flog</strong> - 28.0</li><li><strong>Flog total</strong> - 182.4</li><li><strong>Flay</strong> - 0</li><li><strong>Tests</strong> - 145 examples, 0 failures</li></ul><h1 id="podsumowanie">Podsumowanie</h1><p>Podsumuję teraz to co udało nam się osiągnąć:</p><ul><li>Użyłyśmy bardziej opisowych nazw w kodzie.</li><li>Uprościłyśmy kod używając odrobiny meta-programowania.</li><li>Stworzyłyśmy małe obiekty z małą odpowiedzialnością (wiedzą).</li><li>Przygotowałyśmy całe zaplecze klas sprawdzających zasady pokera.</li></ul><h1 id="co-dalej">Co dalej?</h1><p>Myślisz, że to już koniec refaktoringu? Ja myślę o tym w zupełnie inny sposób. Moim zadaniem refaktoring nigdy się nie kończy. To nie znaczy, że trzeba go robić w nieskończoność. Zawsze będzie coś do zmiany, do ulepszenia. Z czasem mamy więcej informacji o tym jaką logikę kod ma reprezentować. Wiemy dokładnie, co się stanie. Na bazie tej wiedzy możemy podejmować kolejne kroki dotyczące naszej architektury.</p><p>Kiedy teraz patrzę na ten kod, zmieniłabym go. Zaczęłabym od powtórzeń, które jeszcze widzę w istniejących klasach. Pewnie zauważyłaś też, że część tych klas jest dość generyczna i wyglądają dość podobnie. W następnym etapie usunęłabym te klasy i stworzyłabym jedną klasę, która pobierałaby nazwę i logikę potrzebnej zasady. Później zrobiłabym porządek w testach. Może wyciągnęłabym konfigurację z klasy <code class="highlighter-rouge">Hand</code> do jakiegoś osobnego pliku np. <code class="highlighter-rouge">.yml</code>. A może to konfiguracja mogłaby przygotowywać kod związany z zasadami? Czy to za dużo refaktoringu dla tak małej funkcjonalności? Pewnie tak, jest to tylko przykład co można zrobić w prawdziwym kodzie by ułatwić jego rozumienie.</p><h1 id="czego-się-nauczyłam">Czego się nauczyłam?</h1><ul><li>małe, czytelne i proste do testowania klasy wiele ułatwiają</li><li>przy małych klasach, kod staje się bardziej elastyczny (Mogę używać kodu w różny, czasem nieoczekiwany, sposób)</li><li>mniej zależności, w łatwy sposób możemy usuwać i dodawać nowe zasady</li><li>jesteśmy otwarci na rozszerzanie kodu - nie musimy modyfikować istniejącego kodu by dodać nową logikę, wystarczy stworzyć nową klasę i przygotować odpowiednią konfigurację. Możemy też pomyśleć o konwencji, która przygotuje konfigurację za nas. Wtedy wszystko działałoby automatycznie.</li><li>To była czysta zabawa!</li></ul><h1 id="moje-zasady-na-refaktoring">Moje zasady na refaktoring</h1><ul><li>po każdym kroku refaktoringu testy muszą przechodzić</li><li>zacznij od detali a później przejdź do bardziej ogólnego spojrzenia</li><li>nie zmieniaj wszystkiego naraz</li><li>kod powinien być napisany tak, by nie potrzebował komentarzy, powinien być samo-komentujący się (są przypadki gdy warto umieścić komentarz w kodzie, ale nieczytelny kod nie powinien być do tego wymówką)</li><li>narzędzia takie jak Rubocop lub Reek są po to, by pomóc; nie wiedzą jednak wszystkiego</li><li>staraj się zapobiegać powtórzeniom w kodzie, jednak pamiętaj, że lepiej zostawić kod powielony niż wyciągnąć złą abstrakcję (sprawdź prezentację Sandi Mezt w bibliografii)</li><li>publiczny interfejs powinien być mały</li><li>zawsze myśl o całym swoim systemie, jak duży wpływ na niego będzie miała Twoja zmiana?</li><li>pamiętaj o zasadach takich jak <strong>SOLID</strong></li><li>usuwaj powtórzenia w mądry sposób</li><li>myśl ogólnie i zawsze pamiętaj o spojrzeniu całościowym</li></ul><h1 id="na-koniec">Na koniec</h1><p>Chciałabym wspomnieć jeszcze o jednej rzeczy na koniec. Przy każdym kroku zamieszczałam statystyki (wyniki różnych metryk). Nie wiem czy zwróciłaś na to uwagę ale w trakcie trwania refaktoringu te statystyki były gorsze niż na początku. Nigdy nie rezygnuj z refaktoringu z tego powodu. Jeżeli masz dobrą intuicję i plan gdzie chcesz być na jego końcu, krok po kroku kontynuuj swoją podróż a zobaczysz efekty.</p><p>To wszystko. W tym artykule zamieściłam kilka pomysłów na refaktoring. Możesz ich używać całkowicie niezależenie. Kroki mogą być wykonywane w innej kolejności (nie wszystkie, ale część z pewnością). Nie musisz też wykorzystywać ich wszystkich. Jeżeli podobał Ci się ten artykuł, podziel się swoimi przemyśleniami poniżej w komentarzach. Do zobaczenia następnym razem!</p><hr /><h3 id="bibliografia">Bibliografia</h3><h4 id="książki">Książki</h4><ul><li><a href="https://helion.pl/view/10301k/refukv.htm#format/d" title="Książka opisuje proces refaktoryzacji i wyjaśnia różne jej sposoby" target="_blank" rel="nofollow noopener">Refaktoryzacja. Ulepszanie struktury istniejącego kodu - Martin Fowler</a></li><li><a href="https://helion.pl/view/10301k/czykov.htm#format/d" title="Ta książka jest niezbędna dla każdego programisty, inżyniera oprogramowania, kierownika projektu, kierownika zespołu lub analityka systemowego, którzy są zainteresowani tworzeniem lepszego kodu." target="_blank" rel="nofollow noopener">Czysty kod. Podręcznik dobrego programisty - Robert C. Martin</a></li><li><a href="https://helion.pl/view/10301k/rubywz.htm#format/d" title="Ta książka stanowi doskonałą ilustrację kluczowych wzorców projektowych &quot;Gangu czworga&quot; bez uciekania się do zbyt technicznych wyjaśnień." target="_blank" rel="nofollow noopener">Ruby. Wzorce projektowe - Russ Olsen</a></li><li><a href="https://helion.pl/view/10301k/tddszt.htm#format/d" title="Książka opisuje krok po kroku dwa projekty TDD od początku do końca, ilustrując techniki, które programiści mogą wykorzystać, aby podnieść jakość swojej pracy." target="_blank" rel="nofollow noopener">TDD. Sztuka tworzenia dobrego kodu - Ken Beck</a></li><li><a href="https://www.amazon.de/gp/product/0134456475?ie=UTF8&amp;tag=womanonrails-21&amp;camp=1638&amp;linkCode=xm2&amp;creativeASIN=0134456475" title="POODR to praktyczne i czytelne wprowadzenie do tego, w jaki sposób projektowanie obiektowe może obniżyć koszty i ulepszyć aplikacje." target="_blank" rel="nofollow noopener">Practical Object-Oriented Design in Ruby: An Agile Primer - Sandi Metz [EN]</a></li><li><a href="https://helion.pl/view/10301k/pragpv.htm#format/d" title="Jest to jedna z tych rzadkich książek technicznych, które przeczytasz wielokrotnie przez lata i za każdym razem będziesz mieć nowe, świeże spojrzenie." target="_blank" rel="nofollow noopener">Pragmatyczny programista. Od czeladnika do mistrza - Andrew Hund, David Thomas</a></li></ul><h4 id="prezentacje-angielskojęzyczne">Prezentacje angielskojęzyczne</h4><ul><li><a href="https://www.youtube.com/watch?v=8bZh5LMaSmE" rel="nofollow noopener noreferrer" title="All the Little Things by Sandi Metz" target="_blank">All the Little Things by Sandi Metz</a></li><li><a href="https://www.youtube.com/watch?v=5yX6ADjyqyE" rel="nofollow noopener noreferrer" title="Fat Models with Patterns by Bryan Helmkamp" target="_blank">LA Ruby Conference 2013 Refactoring Fat Models with Patterns by Bryan Helmkamp</a></li><li><a href="https://www.youtube.com/watch?v=OMPfEXIlTVE" rel="nofollow noopener noreferrer" title="Nothing is something by Sandi Metz" target="_blank">Nothing is something by Sandi Metz</a></li><li><a href="https://infinum.co/the-capsized-eight/best-ruby-on-rails-refactoring-talks" rel="nofollow noopener noreferrer" title="8 best Ruby on Rails refactoring talks" target="_blank">Best Ruby on Rails refactoring talks</a></li></ul><br><div class='entry-tags text-center'> <span class='svg--tags'><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 230 230"><path d="M95.084 0H.13v95.475L134.658 230l95.212-95.212L95.084 0zM61.138 61.268c-6.988 6.989-18.321 6.989-25.309 0-6.989-6.987-6.99-18.321 0-25.308 6.987-6.99 18.321-6.989 25.309 0 6.989 6.987 6.989 18.321 0 25.308z"/></svg></span> Tagged with <a href="/pl/tags/#Ruby" data-toggle='tooltip' title='Posts tagged with Ruby' rel='tag'>Ruby</a></div></div></article></div><footer class='post-footer entry-meta'><div class='post-share text-center'><p class='light small'> Share this post</p><ul class='social-mini'><li> <a data-toggle='tooltip' href="https://twitter.com/intent/tweet?text=&quot;Refaktoring w Ruby krok po kroku - część 2&quot;%20https://womanonrails.com/refactoring-part2%20via%20&#64;womanonrails" onclick="window.open(this.href, 'twitter-share', 'width=550,height=235');return false;" title='Share on Twitter'> <span class='svg--twitter'><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path d="M459.37 151.716c.325 4.548.325 9.097.325 13.645 0 138.72-105.583 298.558-298.558 298.558-59.452 0-114.68-17.219-161.137-47.106 8.447.974 16.568 1.299 25.34 1.299 49.055 0 94.213-16.568 130.274-44.832-46.132-.975-84.792-31.188-98.112-72.772 6.498.974 12.995 1.624 19.818 1.624 9.421 0 18.843-1.3 27.614-3.573-48.081-9.747-84.143-51.98-84.143-102.985v-1.299c13.969 7.797 30.214 12.67 47.431 13.319-28.264-18.843-46.781-51.005-46.781-87.391 0-19.492 5.197-37.36 14.294-52.954 51.655 63.675 129.3 105.258 216.365 109.807-1.624-7.797-2.599-15.918-2.599-24.04 0-57.828 46.782-104.934 104.934-104.934 30.213 0 57.502 12.67 76.67 33.137 23.715-4.548 46.456-13.32 66.599-25.34-7.798 24.366-24.366 44.833-46.132 57.827 21.117-2.273 41.584-8.122 60.426-16.243-14.292 20.791-32.161 39.308-52.628 54.253z"/></svg></span> </a></li><li> <a data-toggle='tooltip' href='https://www.facebook.com/sharer/sharer.php?u=https://womanonrails.com/refactoring-part2' onclick="window.open(this.href, 'facebook-share','width=580,height=296');return false;" title='Share on Facebook'> <span class='svg--facebook'><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 264 512"><path d="M76.7 512V283H0v-91h76.7v-71.7C76.7 42.4 124.3 0 193.8 0c33.3 0 61.9 2.5 70.2 3.6V85h-48.2c-37.8 0-45.1 18-45.1 44.3V192H256l-11.7 91h-73.6v229"/></svg></span> </a></li></ul></div><div class="post-author text-center"> <img src="https://womanonrails.com/images/womanonrails-square.svg" alt="Agnieszka Małaszkiewicz's photo" itemprop="image" class="post-avatar img-circle img-responsive"/><h4 class="bordered-bottom vcard author" itemprop="author" itemscope itemtype="https://schema.org/Person">By <span itemprop="name" class="fn"><a href="https://womanonrails.com/about" title="About Agnieszka Małaszkiewicz" itemprop="url">Agnieszka Małaszkiewicz</a></span></h4><p>Woman, programmer, mentor, speaker, photographer and dancer with passion.</p></div></footer></div></div><footer id='footer' class='blog-background overlay text-center align-middle animated from-top'><div class='inner'><div class='container'><ul class='social-icons'><li> <a href='https://twitter.com/womanonrails' rel='nofollow noopener noreferrer' target='_blank'> <span class='svg--twitter'><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path d="M459.37 151.716c.325 4.548.325 9.097.325 13.645 0 138.72-105.583 298.558-298.558 298.558-59.452 0-114.68-17.219-161.137-47.106 8.447.974 16.568 1.299 25.34 1.299 49.055 0 94.213-16.568 130.274-44.832-46.132-.975-84.792-31.188-98.112-72.772 6.498.974 12.995 1.624 19.818 1.624 9.421 0 18.843-1.3 27.614-3.573-48.081-9.747-84.143-51.98-84.143-102.985v-1.299c13.969 7.797 30.214 12.67 47.431 13.319-28.264-18.843-46.781-51.005-46.781-87.391 0-19.492 5.197-37.36 14.294-52.954 51.655 63.675 129.3 105.258 216.365 109.807-1.624-7.797-2.599-15.918-2.599-24.04 0-57.828 46.782-104.934 104.934-104.934 30.213 0 57.502 12.67 76.67 33.137 23.715-4.548 46.456-13.32 66.599-25.34-7.798 24.366-24.366 44.833-46.132 57.827 21.117-2.273 41.584-8.122 60.426-16.243-14.292 20.791-32.161 39.308-52.628 54.253z"/></svg></span> </a></li><li> <a href='https://facebook.com/107403177317825' rel='nofollow noopener noreferrer' target='_blank'> <span class='svg--facebook'><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 264 512"><path d="M76.7 512V283H0v-91h76.7v-71.7C76.7 42.4 124.3 0 193.8 0c33.3 0 61.9 2.5 70.2 3.6V85h-48.2c-37.8 0-45.1 18-45.1 44.3V192H256l-11.7 91h-73.6v229"/></svg></span> </a></li><li> <a href='https://stackoverflow.com/users/2885676/womanonrails' rel='nofollow noopener noreferrer' target='_blank'> <span class='svg--stackoverflow'><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 384 512"><path d="M293.7 300l-181.2-84.5 16.7-36.5 181.3 84.7-16.8 36.3zm48-76L188.2 95.7l-25.5 30.8 153.5 128.3 25.5-30.8zm39.6-31.7L262 32l-32 24 119.3 160.3 32-24zM290.7 311L95 269.7 86.8 309l195.7 41 8.2-39zm31.6 129H42.7V320h-40v160h359.5V320h-40v120zm-39.8-80h-200v39.7h200V360z"/></svg></span> </a></li><li> <a href='https://linkedin.com/in/womanonrails' rel='nofollow noopener noreferrer' target='_blank'> <span class='svg--linkedin'><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path d="M100.3 480H7.4V180.9h92.9V480zM53.8 140.1C24.1 140.1 0 115.5 0 85.8 0 56.1 24.1 32 53.8 32c29.7 0 53.8 24.1 53.8 53.8 0 29.7-24.1 54.3-53.8 54.3zM448 480h-92.7V334.4c0-34.7-.7-79.2-48.3-79.2-48.3 0-55.7 37.7-55.7 76.7V480h-92.8V180.9h89.1v40.8h1.3c12.4-23.5 42.7-48.3 87.9-48.3 94 0 111.3 61.9 111.3 142.3V480z"/></svg></span> </a></li><li> <a href='https://instagram.com/womanonrails_programuje' rel='nofollow noopener noreferrer' target='_blank'> <span class='svg--linkedin'><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path d="M224.1 141c-63.6 0-114.9 51.3-114.9 114.9s51.3 114.9 114.9 114.9S339 319.5 339 255.9 287.7 141 224.1 141zm0 189.6c-41.1 0-74.7-33.5-74.7-74.7s33.5-74.7 74.7-74.7 74.7 33.5 74.7 74.7-33.6 74.7-74.7 74.7zm146.4-194.3c0 14.9-12 26.8-26.8 26.8-14.9 0-26.8-12-26.8-26.8s12-26.8 26.8-26.8 26.8 12 26.8 26.8zm76.1 27.2c-1.7-35.9-9.9-67.7-36.2-93.9-26.2-26.2-58-34.4-93.9-36.2-37-2.1-147.9-2.1-184.9 0-35.8 1.7-67.6 9.9-93.9 36.1s-34.4 58-36.2 93.9c-2.1 37-2.1 147.9 0 184.9 1.7 35.9 9.9 67.7 36.2 93.9s58 34.4 93.9 36.2c37 2.1 147.9 2.1 184.9 0 35.9-1.7 67.7-9.9 93.9-36.2 26.2-26.2 34.4-58 36.2-93.9 2.1-37 2.1-147.8 0-184.8zM398.8 388c-7.8 19.6-22.9 34.7-42.6 42.6-29.5 11.7-99.5 9-132.1 9s-102.7 2.6-132.1-9c-19.6-7.8-34.7-22.9-42.6-42.6-11.7-29.5-9-99.5-9-132.1s-2.6-102.7 9-132.1c7.8-19.6 22.9-34.7 42.6-42.6 29.5-11.7 99.5-9 132.1-9s102.7-2.6 132.1 9c19.6 7.8 34.7 22.9 42.6 42.6 11.7 29.5 9 99.5 9 132.1s2.7 102.7-9 132.1z"/></svg></span> </a></li><li> <a href='https://github.com/womanonrails' rel='nofollow noopener noreferrer' target='_blank'> <span class='svg--github'><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><path d="M165.9 399.378c0 2.052-2.3 3.693-5.2 3.693-3.3.307-5.6-1.334-5.6-3.693 0-2.05 2.3-3.692 5.2-3.692 3-.307 5.6 1.334 5.6 3.692zm-31.1-4.615c-.7 2.051 1.3 4.41 4.3 5.026 2.6 1.025 5.6 0 6.2-2.052.6-2.05-1.3-4.41-4.3-5.333-2.6-.718-5.5.308-6.2 2.36zm44.2-1.743c-2.9.718-4.9 2.666-4.6 5.025.3 2.051 2.9 3.385 5.9 2.667 2.9-.718 4.9-2.667 4.6-4.718-.3-1.949-3-3.282-5.9-2.974zM244.8 0C106.1 0 0 107.998 0 250.253c0 113.741 69.8 211.073 169.5 245.33 12.8 2.358 17.3-5.744 17.3-12.411 0-6.359-.3-41.435-.3-62.973 0 0-70 15.384-84.7-30.564 0 0-11.4-29.846-27.8-37.538 0 0-22.9-16.102 1.6-15.794 0 0 24.9 2.05 38.6 26.46 21.9 39.59 58.6 28.205 72.9 21.436 2.3-16.41 8.8-27.794 16-34.563-55.9-6.36-112.3-14.667-112.3-113.332 0-28.205 7.6-42.358 23.6-60.41-2.6-6.666-11.1-34.153 2.6-69.64 20.9-6.666 69 27.693 69 27.693 20-5.744 41.5-8.718 62.8-8.718 21.3 0 42.8 2.974 62.8 8.718 0 0 48.1-34.461 69-27.692 13.7 35.589 5.2 62.973 2.6 69.64 16 18.153 25.8 32.307 25.8 60.409 0 98.973-58.9 106.87-114.8 113.332 9.2 8.102 17 23.486 17 47.589 0 34.563-.3 77.332-.3 85.742 0 6.666 4.6 14.769 17.3 12.41 100-34.05 167.8-131.383 167.8-245.124C496 107.998 383.5 0 244.8 0zM97.2 353.738c-1.3 1.026-1 3.385.7 5.333 1.6 1.641 3.9 2.36 5.2 1.026 1.3-1.026 1-3.385-.7-5.333-1.6-1.641-3.9-2.36-5.2-1.026zm-10.8-8.307c-.7 1.333.3 2.974 2.3 4 1.6 1.025 3.6.717 4.3-.718.7-1.334-.3-2.975-2.3-4-2-.616-3.6-.308-4.3.718zm32.4 36.512c-1.6 1.333-1 4.41 1.3 6.359 2.3 2.359 5.2 2.666 6.5 1.025 1.3-1.333.7-4.41-1.3-6.359-2.2-2.358-5.2-2.666-6.5-1.025zm-11.4-15.077c-1.6 1.026-1.6 3.692 0 6.051 1.6 2.36 4.3 3.385 5.6 2.36 1.6-1.334 1.6-4 0-6.36-1.4-2.359-4-3.384-5.6-2.05z"/></svg></span> </a></li></ul><div> Agnieszka Małaszkiewicz &copy; 2021 &bull; All rights reserved.</div><ul class='menu-items'><li> <a href="/"> <span class='svg--home'><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path d="M16 256L256 64l96 72v-32h48v72l96 80h-48v192H328V288h-96v160H64V256z"/></svg></span> </a>&bull;</li><li> <a href="/workshops"> Programming courses </a>&bull;</li><li> <a href="/categories"> Categories </a>&bull;</li><li> <a href="/tags"> Tags </a>&bull;</li><li> <a href="/about"> About </a>&bull;</li><li> <a href="/pl/feed.xml" title='Atom/RSS feed'> <span class='svg--rss'><svg role="img" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><title>RSS icon</title><path d="M19.199 24C19.199 13.467 10.533 4.8 0 4.8V0c13.165 0 24 10.835 24 24h-4.801zM3.291 17.415c1.814 0 3.293 1.479 3.293 3.295 0 1.813-1.485 3.29-3.301 3.29C1.47 24 0 22.526 0 20.71s1.475-3.294 3.291-3.295zM15.909 24h-4.665c0-6.169-5.075-11.245-11.244-11.245V8.09c8.727 0 15.909 7.184 15.909 15.91z"/></svg></span> Feed </a></li></ul></div><div> <a class='btn btn-default' href='https://paypal.me/womanonrails' target='_blank' rel='nofollow noopener' style='border-radius: 10px !important;'> <img alt='PayPal' height='20' src='/images/donations/paypal.svg'> </a> <a href='https://ko-fi.com/womanonrails' target='_blank' rel='nofollow noopener'> <img alt='Ko-fi' height='34' src='/images/donations/ko-fi.svg'> </a></div></div><div class="decor-wrapper"> <svg id="footer-decor" class="decor top" xmlns="https://www.w3.org/2000/svg" version="1.1" viewBox="0 0 100 100" preserveAspectRatio="none"><path class="large left" d="M0 0 L50 50 L0 100" fill="rgba(255,255,255, .1)"></path><path class="large right" d="M100 0 L50 50 L100 100" fill="rgba(255,255,255, .1)"></path><path class="medium left" d="M0 0 L50 50 L0 66.6" fill="rgba(255,255,255, .3)"></path><path class="medium right" d="M100 0 L50 50 L100 66.6" fill="rgba(255,255,255, .3)"></path><path class="small left" d="M0 0 L50 50 L0 33.3" fill="rgba(255,255,255, .5)"></path><path class="small right" d="M100 0 L50 50 L100 33.3" fill="rgba(255,255,255, .5)"></path><path d="M0 0 L50 50 L100 0 L0 0" fill="rgba(255,255,255, 1)"></path><path d="M48 48 L50 51 L52 48 L48 48" fill="rgba(255,255,255, 1)"></path> </svg></div></footer><script async src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script> <script>window.jQuery || document.write('<script src="https://womanonrails.com/assets/js/vendor/jquery-1.9.1.min.js"><\/script>')</script> <script src="https://womanonrails.com/assets/js/scripts.min.js"></script> <script type="text/javascript" src="https://womanonrails.com/assets/js/waypoints.min.js"></script> <script type="text/javascript" src="https://womanonrails.com/assets/js/script.js"></script> <script type='text/javascript'>$(document).ready(function(){$(".time").text(function(a,b){return Math.round(parseFloat(b))})});</script> <script type="text/javascript"> /* Slides */ $("a#slide").click(function(){ $("#sidebar,body,a#slide,#fade").addClass("slide") }); $("#fade,#header,#posts-container").click(function(){ $("#sidebar,body,a#slide,#fade").removeClass("slide") }); $("a#click-filter").click(function(){ $("#slide-filter").slideToggle("medium"); $("#slide-pages").slideOut("medium"); }); $("a#click-pages").click(function(){ $("#slide-pages").slideToggle("medium"); $("#slide-filter").slideOut("medium"); }); /* End-Slides */ </script> <script> $(document).ready(function() { $('.search-field').simpleJekyllSearch({ jsonFile : '/pl/search.json', searchResults : '.search-results', template : '<li><article><a href="{url}">{title} <span class="entry-date"><time datetime="{date}">{shortdate}</time></span></a></article></li>', noResults: '<p>Nothing found.</p>' }); }); (function( $, window, undefined ) { var bs = { close: $(".js-remove-sign"), searchform: $(".search-form"), canvas: $("body"), dothis: $('.dosearch') }; bs.dothis.on('click', function() { $('.search-wrapper').css({ display: "block" }); bs.searchform.toggleClass('active'); bs.searchform.find('input').focus(); bs.canvas.toggleClass('search-overlay'); }); bs.close.on('click', function() { $('.search-wrapper').removeAttr( 'style' ); bs.searchform.toggleClass('active'); bs.canvas.removeClass('search-overlay'); }); })( jQuery, window ); </script> <script async src="https://www.googletagmanager.com/gtag/js?id=UA-127731573-1"></script> <script> window.dataLayer = window.dataLayer || []; function gtag(){dataLayer.push(arguments);} gtag('js', new Date()); gtag('config', 'UA-127731573-1'); </script></body></html>
